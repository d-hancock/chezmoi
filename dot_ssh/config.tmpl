# ===================================================================
# SSH Configuration - ChezMoi Managed
# ===================================================================
# This file is managed by ChezMoi and will be applied to ~/.ssh/config
# Platform-aware configuration using ChezMoi templating
{{- $isWSL := (and (eq .chezmoi.os "linux") ((.chezmoi.kernel.osrelease | lower) | contains "microsoft")) -}}
{{- $isWindows := eq .chezmoi.os "windows" -}}
{{- $isLinux := (and (eq .chezmoi.os "linux") (not $isWSL)) -}}

# ===================================================================
# Global SSH Settings
# ===================================================================
# Security and performance defaults for all connections
Host *
  # Use SSH protocol 2 only (more secure)
  Protocol 2
  
  # Enable compression for faster transfers
  Compression yes
  
  # Keep connections alive to prevent timeouts
  ServerAliveInterval 60
  ServerAliveCountMax 3
  
  # Connection multiplexing for performance
  ControlMaster auto
  ControlPath ~/.ssh/sockets/%r@%h-%p
  ControlPersist 600
  
  # Security settings
  StrictHostKeyChecking ask
  VerifyHostKeyDNS yes
  
  # Prefer modern key exchange algorithms
  KexAlgorithms curve25519-sha256@libssh.org,diffie-hellman-group16-sha512
  HostKeyAlgorithms ssh-ed25519,rsa-sha2-512,rsa-sha2-256
  Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com
  MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com

# ===================================================================
# Platform-Specific Key Management
# ===================================================================
{{- if $isWindows }}
# Windows-specific SSH key
Host github.com
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_ed25519_win
  IdentitiesOnly yes

Host gitlab.com
  HostName gitlab.com
  User git
  IdentityFile ~/.ssh/id_ed25519_win
  IdentitiesOnly yes
{{- else }}
# Linux/WSL SSH key
Host github.com
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_ed25519
  IdentitiesOnly yes

Host gitlab.com
  HostName gitlab.com
  User git
  IdentityFile ~/.ssh/id_ed25519
  IdentitiesOnly yes
{{- end }}

# ===================================================================
# Common Development Hosts
# ===================================================================
# Add your commonly used hosts here

# Example: Development server
# Host dev
#   HostName dev.example.com
#   User developer
#   Port 2222
#   {{- if $isWindows }}
#   IdentityFile ~/.ssh/id_ed25519_win
#   {{- else }}
#   IdentityFile ~/.ssh/id_ed25519
#   {{- end }}

# Example: Production server (more secure settings)
# Host prod
#   HostName prod.example.com
#   User deploy
#   Port 22
#   StrictHostKeyChecking yes
#   {{- if $isWindows }}
#   IdentityFile ~/.ssh/id_ed25519_win
#   {{- else }}
#   IdentityFile ~/.ssh/id_ed25519
#   {{- end }}

# ===================================================================
# SSH Socket Directory Setup
# ===================================================================
# Create socket directory for connection multiplexing
# This is handled by the setup script
