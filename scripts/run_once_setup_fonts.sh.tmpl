#!/usr/bin/env bash
# ===================================================================
# ChezMoi Bootstrap Script - Font Installation
# ===================================================================
# This script runs once when ChezMoi is first applied
# It downloads and installs Monaspace Nerd Fonts for terminal use
# These fonts provide programming ligatures and Nerd Font icons
# 
# Execution: Automatically run by ChezMoi on first 'chezmoi apply'
# Template: This is a .tmpl file, so it can use ChezMoi variables

set -e  # Exit on any error

echo "üî§ Installing Nerd Fonts..."

# ===================================================================
# Font Directory Setup
# ===================================================================
# Create user font directory following Linux standards
FONT_DIR="$HOME/.local/share/fonts"
mkdir -p "$FONT_DIR"
echo "üìÅ Font directory created: $FONT_DIR"

# ===================================================================
# Monaspace Nerd Font Download
# ===================================================================
# Download Monaspace Nerd Font - a modern coding font with ligatures
# Version 3.2.1 is stable and well-tested
FONT_URL="https://github.com/ryanoasis/nerd-fonts/releases/download/v3.2.1/Monaspace.zip"
TEMP_FILE="/tmp/Monaspace.zip"
EXTRACT_DIR="$FONT_DIR/Monaspace"

echo "‚¨áÔ∏è  Downloading Monaspace Nerd Font..."
curl -L "$FONT_URL" -o "$TEMP_FILE"
echo "‚úÖ Download complete"

# ===================================================================
# Font Installation
# ===================================================================
# Extract fonts to user font directory
echo "üì¶ Extracting fonts..."
unzip -o "$TEMP_FILE" -d "$EXTRACT_DIR"
echo "‚úÖ Fonts extracted to $EXTRACT_DIR"

# ===================================================================
# Font Cache Update
# ===================================================================
# Update font cache so the system recognizes new fonts
echo "üîÑ Updating font cache..."
fc-cache -fv
echo "‚úÖ Font cache updated"

# ===================================================================
# Cleanup
# ===================================================================
# Remove temporary download file
rm -f "$TEMP_FILE"
echo "üßπ Cleanup complete"

echo "üéâ Monaspace Nerd Font installation complete!"
echo "üí° Restart your terminal to use the new fonts"
